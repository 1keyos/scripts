#!/bin/bash

# Copyright (c) 2010 The Chromium OS Authors. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

# Start the Dev Server after making sure we are running under a chroot.

. "$(dirname "$0")/common.sh"

# Script must be run inside the chroot if not in 'always serve' mode.
if [[ "$1" != "--archive_dir" ]]
then
  restart_in_chroot_if_needed $*
fi

# Temporary workaround: to start devserver for update engine, pass in args
# --client_prefix ChromeOSUpdateEngine

# Set PKG_INSTALL_MASK if it's not set already.
if [ -z "${PKG_INSTALL_MASK+x}" ]; then
  export PKG_INSTALL_MASK="${DEFAULT_INSTALL_MASK}"
fi
echo PKG_INSTALL_MASK=$PKG_INSTALL_MASK

cd ${GCLIENT_ROOT}/src/platform/dev && python devserver.py $*
